#
# $Id: Makefile.in 996 2009-03-19 18:14:44Z csc $
# 
# Makefile
SHELL = @SHELL@

srcdir = @srcdir@
top_srcdir = @top_srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@

bindir = @bindir@
sbindir = @sbindir@
libexecdir = @libexecdir@
datadir = @datadir@
datarootdir = @datarootdir@
libdir = @libdir@
mandir = @mandir@
includedir = @includedir@
top_builddir = .

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_SCRIPT = @INSTALL_SCRIPT@
INSTALL_HEADER = $(INSTALL_DATA)
CC = @CC@
EXEEXT = @EXEEXT@
OBJEXT = @OBJEXT@
PACKAGE = @PACKAGE_NAME@
VERSION = @PACKAGE_VERSION@
install_sh = @install_sh@
OPENSSL = @OPENSSL@

DEFS = @DEFS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@ @PCAPLIBS@ -lipfix -lmisc -lev -lm
PFLIBS = $(LIBS) -lpfring
CCOPT = -Wall -g
INCLS = -I.
CFLAGS = $(CCOPT) $(INCLS) $(DEFS)

TARGETS = impd4e
#settings.c bobhash.c hash.c hsieh.c main.c twmx.c logger.c stats.c netcon.c ev_handler.c helper.c pfring_filter.c
SRCS = $(wildcard *.c) 
OBJS = $(SRCS:.c=.o)
PFOBJ = $(OBJS) pfring_filter.o
DEPHDR = settings.h bobhash.h hash.h hsieh.h main.h templates.h twmx.h logger.h stats.h netcon.h ev_handler.h helper.h constants.h pfring_filter.h
CLEANFILES = $(TARGETS) *.o *.d 

# default target
all: $(TARGETS)

# include rules file for each object file
-include $(SRCS:.c=.d)

impd4e: $(OBJS)
	$(CC) $(CFLAGS) $(CPPFLAGS) $(LDFLAGS) $(OBJS) $(LIBS) -o $@

impd4e_pf: $(OBJS) $(DEPHDR)
	$(CC) $(CFLAGS) $(CPPFLAGS) $(LDFLAGS) $(PFOBJS) $(PFLIBS) -o $@

# generate rules file with all dependencies for each object file
%.d: %.c
	@set -e; rm -f $@; \
	$(CC) -MM $(CFLAGS) $(CPPFLAGS) $< > $@.$$$$; \
	sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' < $@.$$$$ > $@; \
	rm -f $@.$$$$

# generate each object file
%.o: %.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) $< -o $@

clean:
	rm -f $(CLEANFILES)

distclean:
	rm -f $(CLEANFILES) $(DHPARAMS) Makefile

install:
	@[ -d $(DESTDIR)${bindir} ] || (mkdir -p $(DESTDIR)${bindir}; chmod 755 $(DESTDIR)${bindir})
	$(INSTALL_DATA) $(TARGETS) $(DESTDIR)/${bindir}/
	chmod 755 $(DESTDIR)${bindir}/$(TARGETS)

uninstall:
	rm -f $(DESTDIR)${bindir}/$(TARGETS)	

releasetar:
	@cwd=`pwd`; dir=`basename $$cwd`; name=$(PACKAGE)-`cat VERSION`; mkdir $$name; \
	tar cf - *.c *.h config/ configure configure.ac config.h.in Makefile.in | (cd $$name; tar xf -);\
	tar -czvf $$name.tar.gz $$name;\
	rm -rf $$name

binary-package:
	mkdir -p ./package/usr/bin
	cp $(PACKAGE) ./package/usr/bin
	dpkg -b package $(PACKAGE)_$(VERSION)_all.deb

